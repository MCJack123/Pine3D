local a=(...):match("(.-)[^%.]+$")local b=require(a.."betterblittle")local c={}for d=1,16 do c[2^(d-1)]=("0123456789abcdef"):sub(d,d)end;local e=math.pow(10,99)local function f(g,h,i,j)local k=i-g;if k==0 then return e,-e*g end;local l=(j-h)/k;return l,h-l*g end;local m=math.min;local n=math.max;local o=math.floor;local p=math.ceil;local function q(g,h,i,j)local r={x1=g,y1=h,x2=i,y2=j,width=i-g+1,height=j-h+1,screenBuffer={{}},blittleWindow=nil,blittleOn=false,backgroundColor=colors.lightBlue}function r:setBufferSize(s,t,u,v)self.x1=s;self.y1=t;self.x2=u;self.y2=v;self.width=u-s+1;self.height=v-t+1;if self.blittleWindow then self.blittleWindow=self.blittleWindow.reposition(self.x1,self.y1,self.x1+self.width-1,self.y1+self.height-1)end;self:clear()end;function r:clear()local w=self.screenBuffer;w.c2={}local x=w.c2;local y=self.width;local z=self.backgroundColor;if self.blittleOn then for A=1,self.height do x[A]={}local B=x[A]for C=1,y do B[C]=z end end else local D=c[z]w.c1={}local E=w.c1;w.chars={}local F=w.chars;for A=1,self.height do E[A]={}x[A]={}F[A]={}local G=E[A]local B=x[A]local H=F[A]for C=1,y do G[C]=D;B[C]=D;H[C]=" "end end end end;function r:fastClearNormal()local I=self.backgroundColor;local w=self.screenBuffer;local F=w.chars;local E=w.c1;local x=w.c2;local I=c[I]local y=self.width;for A=1,self.height do local H=F[A]local G=E[A]local B=x[A]for C=1,y do H[C]=" "G[C]=I;B[C]=I end end end;function r:fastClearBLittle()local I=self.backgroundColor;local x=self.screenBuffer.c2;local y=self.width;for A=1,self.height do local B=x[A]for C=1,y do B[C]=I end end end;function r:setPixel(C,A,E,x,J)C=math.floor(C+0.5)A=math.floor(A+0.5)if C>=1 and C<=self.width then if A>=1 and A<=self.height then local w=self.screenBuffer;if self.blittleOn then w.c2[A][C]=x or E else w.c1[A][C]=c[E]w.c2[A][C]=c[x or E]w.chars[A][C]=" "end end end end;function r:image(k,K,L)for A,M in pairs(L)do for C,N in pairs(M)do if N and N>0 then if self.blittleOn then self:setPixel(C+(k-1)*2,A+(K-1)*3,N,N," ")else self:setPixel(C+k-1,A+K-1,N,N," ")end end end end end;function r:loadLineNormal(g,h,i,j,I,J,O,l,P)local w=self.screenBuffer;local E=w.c1;local x=w.c2;local F=w.chars;local Q=self.width;local R=self.height;if i>=g then for C=n(p(g),1),m(o(i),Q)do local A=o(l*C+P+0.5)if A>0 and A<=R then E[A][C]=O;x[A][C]=I;F[A][C]=J end end else for C=n(p(i),1),m(o(g),Q)do local A=o(l*C+P+0.5)if A>0 and A<=R then E[A][C]=O;x[A][C]=I;F[A][C]=J end end end;if j>=h then for A=n(p(h),1),m(o(j),R)do local C=o((A-P)/l+0.5)if C>0 and C<=Q then E[A][C]=O;x[A][C]=I;F[A][C]=J end end else for A=n(p(j),1),m(o(h),R)do local C=o((A-P)/l+0.5)if C>0 and C<=Q then E[A][C]=O;x[A][C]=I;F[A][C]=J end end end end;function r:loadLineBLittle(g,h,i,j,I,l,P)local w=self.screenBuffer;local x=w.c2;local Q=self.width;local R=self.height;if i>=g then for C=n(p(g),1),m(o(i),Q)do local A=o(l*C+P+0.5)if A>0 and A<=R then x[A][C]=I end end else for C=n(p(i),1),m(o(g),Q)do local A=o(l*C+P+0.5)if A>0 and A<=R then x[A][C]=I end end end;if j>=h then for A=n(p(h),1),m(o(j),R)do local C=o((A-P)/l+0.5)if C>0 and C<=Q then x[A][C]=I end end else for A=n(p(j),1),m(o(h),R)do local C=o((A-P)/l+0.5)if C>0 and C<=Q then x[A][C]=I end end end end;local S=colors.black;function r:drawTriangleNormal(g,h,i,j,T,U,I,J,O,V)if g<1 and i<1 and T<1 or h<1 and j<1 and U<1 then return end;local Q=self.width;if g>Q and i>Q and T>Q then return end;local R=self.height;if h>R and j>R and U>R then return end;if h>j then h,j=j,h;g,i=i,g end;if j>U then U,j=j,U;T,i=i,T end;if h>j then h,j=j,h;g,i=i,g end;local w=self.screenBuffer;local o,p=o,p;local m,n=m,n;local W=m(n(1,p(h)),R)local X=m(n(0,o(j)),R)local Y=m(n(1,o(U)),R)local E=w.c1;local x=w.c2;local F=w.chars;local Z=(i-g)/(j-h)local _=(g-T)/(h-U)J=J or" "O=O or I;local I=c[I]local O=c[O]for A=W,X do local G=E[A]local B=x[A]local H=F[A]local a0=(A-h)*Z+g;local a1=(A-U)*_+T;if a1<a0 then a0,a1=a1,a0 end;if a0<1 then a0=1 end;if a0>Q then a0=Q end;if a1<1 then a1=1 end;if a1>Q then a1=Q end;for C=o(a0+0.5),o(a1+0.5)do G[C]=O;B[C]=I;H[C]=J end end;local a2=(T-i)/(U-j)local _=(g-T)/(h-U)for A=X+1,Y do local G=E[A]local B=x[A]local H=F[A]local a0=(A-j)*a2+i;local a1=(A-U)*_+T;if a1<a0 then a0,a1=a1,a0 end;if a0<1 then a0=1 end;if a0>Q then a0=Q end;if a1<1 then a1=1 end;if a1>Q then a1=Q end;for C=o(a0+0.5),o(a1+0.5)do G[C]=O;B[C]=I;H[C]=J end end;local V=V;if V or self.triangleEdges then local a3,a4=f(g,h,i,j)local a5,a6=f(i,j,T,U)local a7,a8=f(g,h,T,U)local a9=self.loadLineNormal;local I=c[V or S]a9(self,g,h,i,j,I,J,O,a3,a4)a9(self,i,j,T,U,I,J,O,a5,a6)a9(self,T,U,g,h,I,J,O,a7,a8)end end;function r:drawTriangleBLittle(g,h,i,j,T,U,I,J,O,V)if g<1 and i<1 and T<1 or h<1 and j<1 and U<1 then return end;local Q=self.width;if g>Q and i>Q and T>Q then return end;local R=self.height;if h>R and j>R and U>R then return end;if h>j then h,j=j,h;g,i=i,g end;if j>U then U,j=j,U;T,i=i,T end;if h>j then h,j=j,h;g,i=i,g end;local w=self.screenBuffer;local o,p=o,p;local m,n=m,n;local W=m(n(1,p(h)),R)local X=m(n(0,o(j)),R)local Y=m(n(1,o(U)),R)local x=w.c2;local Z=(i-g)/(j-h)local _=(g-T)/(h-U)for A=W,X do local B=x[A]local a0=(A-h)*Z+g;local a1=(A-U)*_+T;if a1<a0 then a0,a1=a1,a0 end;if a0<1 then a0=1 end;if a0>Q then a0=Q end;if a1<1 then a1=1 end;if a1>Q then a1=Q end;for C=o(a0+0.5),o(a1+0.5)do B[C]=I end end;local a2=(T-i)/(U-j)local _=(g-T)/(h-U)for A=X+1,Y do local B=x[A]local a0=(A-j)*a2+i;local a1=(A-U)*_+T;if a1<a0 then a0,a1=a1,a0 end;if a0<1 then a0=1 end;if a0>Q then a0=Q end;if a1<1 then a1=1 end;if a1>Q then a1=Q end;for C=o(a0+0.5),o(a1+0.5)do B[C]=I end end;local V=V;if V or self.triangleEdges then local a3,a4=f(g,h,i,j)local a5,a6=f(i,j,T,U)local a7,a8=f(g,h,T,U)local a9=self.loadLineBLittle;local I=V or S;a9(self,g,h,i,j,I,a3,a4)a9(self,i,j,T,U,I,a5,a6)a9(self,T,U,g,h,I,a7,a8)end end;function r:drawBufferNormal()local g=self.x1;local h=self.y1;local w=self.screenBuffer;local aa=term.setCursorPos;local ab=term.blit;local F=w.chars;local E=w.c1;local x=w.c2;local ac=table.concat;for A=1,self.height do aa(g,A+h-1)local F=ac(F[A])local E=ac(E[A])local x=ac(x[A])ab(F,E,x)end end;function r:drawBufferBLittle()local ad=self.blittleWindow;if not ad then self.blittleWindow=window.create(term.current(),self.x1,self.y1,self.x1+self.width-1,self.y1+self.height-1,false)ad=self.blittleWindow end;b.drawBuffer(self.screenBuffer.c2,ad)ad.setVisible(true)ad.setVisible(false)end;function r:highResMode(ae)self.blittleOn=ae;self.drawTriangle=ae and self.drawTriangleBLittle or self.drawTriangleNormal;self.fastClear=ae and self.fastClearBLittle or self.fastClearNormal;self.drawBuffer=ae and self.drawBufferBLittle or self.drawBufferNormal;self:clear()end;function r:useTriangleEdges(ae)self.triangleEdges=ae end;r:highResMode(true)return r end;local af=table.sort;local function ag(l,P,table)if table[l]==nil or table[P]==nil then return false end;if table[l][16]<table[P][16]then table[l],table[P]=table[P],table[l]return true end;return false end;local function ah(ai)for d=1,#ai do local aj=d;while ag(aj,aj+1,ai)do aj=aj-1 end end end;local function ak(ai)local al=#ai;local am=0;local an=ai[1][16]for d=2,al do local ao=ai[d][16]if ao<=an then am=am+1 end;an=ao end;local ap=am/(al-1)return ap end;local l=8;local function P(I)local aq=0;while I>=l do aq=bit.bor(aq,bit.band(I,1))I=bit.brshift(I,1)end;return I+aq end;local function ar(as,at,au)for d=at+1,au do local av=as[d]local aw=av[16]local ax=d-1;while ax>=at and as[ax][16]>aw do as[ax+1]=as[ax]ax=ax-1 end;as[ax+1]=av end end;local function ay(as,at,au,al,az,aq)local aA=az-al+1;local aB=aq-az;for aC=0,aA-1 do at[aC]=as[al+aC]end;for aC=0,aB-1 do au[aC]=as[az+1+aC]end;local d=0;local ax=0;local aD=al;while d<aA and ax<aB do if at[d][16]<=au[ax][16]then as[aD]=at[d]d=d+1 else as[aD]=au[ax]ax=ax+1 end;aD=aD+1 end;while d<aA do as[aD]=at[d]aD=aD+1;d=d+1 end;while ax<aB do as[aD]=au[ax]aD=aD+1;ax=ax+1 end end;local function aE(as)local I=#as;local aF=P(l)local aG=math.min;for d=1,I,aF do ar(as,d,aG(d+l-1,I))end;local aH,aI={},{}local C=aF;while C<=I do for at=1,I,2*C do local A=at+C-1;local au=aG(A+C,I)if A<au then ay(as,aH,aI,at,A,au)end end;C=2*C end;for d=1,math.floor(I/2)do as[d],as[I-d+1]=as[I-d+1],as[d]end end;local function aJ(aK,aL,aM,aN,aO)local aP=aO[1]local aQ=aO[2]local aR=aO[3]local aS=aL and aL-aP or 0;local aT=aM and aM-aQ or 0;local aU=aN and aN-aR or 0;for d=1,#aK do local aV=aK[d]local aW=aS+(aV[1]+aV[4]+aV[7])/3;local aX=aT+(aV[2]+aV[5]+aV[8])/3;local aY=aU+(aV[3]+aV[6]+aV[9])/3;aV[16]=aW*aW+aX*aX+aY*aY end;local ap=ak(aK)if ap==1 then elseif ap>0.7 then ah(aK)else aE(aK)end end;local aZ=math.rad;local a_=math.sin;local b0=math.cos;local function b1(C,A,b2,b3,b4)local b5=b4*b2-b3*A;local A=b3*b2+b4*A;local b2=b5;return C,A,b2 end;local function b6(C,A,b2,b3,b4)local b5=b4*b2-b3*C;local C=b3*b2+b4*C;local b2=b5;return C,A,b2 end;local function b7(C,A,b2,b3,b4)local j=b4*A-b3*C;local C=b3*A+b4*C;local A=j;return C,A end;local function b8(b9,ba,bb,bc)local bd,be=0,1;local bf,bg=0,1;local bh,bi=0,1;if ba==0 then ba=nil end;if ba then bd,be=a_(ba),b0(ba)end;if bb==0 then bb=nil end;if bb then bf,bg=a_(bb),b0(bb)end;if bc==0 then bc=nil end;if bc then bh,bi=a_(bc),b0(bc)end;local bj={}for bk,aV in pairs(b9)do local g,h,bl=aV[1],aV[2],aV[3]local i,j,b5=aV[4],aV[5],aV[6]local T,U,bm=aV[7],aV[8],aV[9]if bb then g,h,bl=b6(g,h,bl,bf,bg)i,j,b5=b6(i,j,b5,bf,bg)T,U,bm=b6(T,U,bm,bf,bg)end;if bc then g,h=b7(g,h,bl,bh,bi)i,j=b7(i,j,b5,bh,bi)T,U=b7(T,U,bm,bh,bi)end;if ba then g,h,bl=b1(g,h,bl,bd,be)i,j,b5=b1(i,j,b5,bd,be)T,U,bm=b1(T,U,bm,bd,be)end;bj[#bj+1]={g,h,bl,i,j,b5,T,U,bm}bj[#bj][10]=aV[10]bj[#bj][11]=aV[11]bj[#bj][12]=aV[12]bj[#bj][13]=aV[13]bj[#bj][14]=aV[14]bj[#bj][15]=aV[15]end;return bj end;local function bn(l,P,table)if table[l]==nil or table[P]==nil then return false end;if table[l][9]<table[P][9]then table[l],table[P]=table[P],table[l]return true end;return false end;local function bo(ai)for d=1,#ai do local aj=d;while bn(aj,aj+1,ai)do aj=aj-1 end end end;local function bp(ai)local al=#ai;local am=0;local an=ai[1][9]for d=2,al do local ao=ai[d][9]if ao<=an then am=am+1 end;an=ao end;local ap=am/(al-1)return ap end;local function bq(br,aO)local bs=aO[1]local bt=aO[2]local bu=aO[3]for d=1,#br do local bv=br[d]local bw=bv[1]local bx=bv[2]local by=bv[3]local bz=bw and bw-bs or 0;local bA=bx and bx-bt or 0;local bB=by and by-bu or 0;bv[9]=bz*bz+bA*bA+bB*bB end;local ap=bp(br)if ap==1 then elseif ap>0.7 then bo(br)else af(br,function(l,P)return l[9]>P[9]end)end end;local bC={}function bC.invertTriangles(b9)if not b9 or type(b9)~="table"then error("transforms.invertTriangles expected arg#1 to be a table (model)")end;local bD={}for d=1,#b9 do local bE=b9[d]local bF={x1=bE.x1,y1=bE.y1,z1=bE.z1,x2=bE.x3,y2=bE.y3,z2=bE.z3,x3=bE.x2,y3=bE.y2,z3=bE.z2,c=bE.c,char=bE.char,charc=bE.charc,forceRender=bE.forceRender,outlineColor=bE.outlineColor}bD[d]=bF end;return bD end;function bC.setOutline(b9,bG)if not b9 or type(b9)~="table"then error("transforms.invertTriangles expected arg#1 to be a table (model)")end;for d=1,#b9 do local bE=b9[d]if type(bG)=="table"then bE.outlineColor=bG[bE.c]or bE.outlineColor else bE.outlineColor=bG end end;return b9 end;function bC.mapColor(b9,bG)if not b9 or type(b9)~="table"then error("transforms.mapColor expected arg#1 to be a table (model)")end;for d=1,#b9 do local bE=b9[d]if type(bG)=="table"then bE.c=bG[bE.c]or bE.c else bE.c=bG end end;return b9 end;function bC.center(b9)local bH,bI=math.huge,-math.huge;local W,Y=math.huge,-math.huge;local bJ,bK=math.huge,-math.huge;for d=1,#b9 do local bL=b9[d]bH,bI=m(bH,bL.x1),n(bI,bL.x1)bH,bI=m(bH,bL.x2),n(bI,bL.x2)bH,bI=m(bH,bL.x3),n(bI,bL.x3)W,Y=m(W,bL.y1),n(Y,bL.y1)W,Y=m(W,bL.y2),n(Y,bL.y2)W,Y=m(W,bL.y3),n(Y,bL.y3)bJ,bK=m(bJ,bL.z1),n(bK,bL.z1)bJ,bK=m(bJ,bL.z2),n(bK,bL.z2)bJ,bK=m(bJ,bL.z3),n(bK,bL.z3)end;local bM=-(bI+bH)*0.5;local bN=-(Y+W)*0.5;local bO=-(bK+bJ)*0.5;for d=1,#b9 do local bL=b9[d]bL.x1=bL.x1+bM;bL.x2=bL.x2+bM;bL.x3=bL.x3+bM;bL.y1=bL.y1+bN;bL.y2=bL.y2+bN;bL.y3=bL.y3+bN;bL.z1=bL.z1+bO;bL.z2=bL.z2+bO;bL.z3=bL.z3+bO end;return b9 end;function bC.normalizeScale(b9)local bP=-math.huge;for d=1,#b9 do local bL=b9[d]bP=n(bP,bL.x1)bP=n(bP,bL.x2)bP=n(bP,bL.x3)bP=n(bP,bL.y1)bP=n(bP,bL.y2)bP=n(bP,bL.y3)bP=n(bP,bL.z1)bP=n(bP,bL.z2)bP=n(bP,bL.z3)end;for d=1,#b9 do local bL=b9[d]bL.x1=bL.x1/bP;bL.x2=bL.x2/bP;bL.x3=bL.x3/bP;bL.y1=bL.y1/bP;bL.y2=bL.y2/bP;bL.y3=bL.y3/bP;bL.z1=bL.z1/bP;bL.z2=bL.z2/bP;bL.z3=bL.z3/bP end;return b9 end;function bC.normalizeScaleY(b9)local bP=-math.huge;for d=1,#b9 do local bL=b9[d]bP=n(bP,bL.y1)bP=n(bP,bL.y2)bP=n(bP,bL.y3)end;for d=1,#b9 do local bL=b9[d]bL.x1=bL.x1/bP;bL.x2=bL.x2/bP;bL.x3=bL.x3/bP;bL.y1=bL.y1/bP;bL.y2=bL.y2/bP;bL.y3=bL.y3/bP;bL.z1=bL.z1/bP;bL.z2=bL.z2/bP;bL.z3=bL.z3/bP end;return b9 end;function bC.scale(b9,bQ)for d=1,#b9 do local bL=b9[d]bL.x1=bL.x1*bQ;bL.x2=bL.x2*bQ;bL.x3=bL.x3*bQ;bL.y1=bL.y1*bQ;bL.y2=bL.y2*bQ;bL.y3=bL.y3*bQ;bL.z1=bL.z1*bQ;bL.z2=bL.z2*bQ;bL.z3=bL.z3*bQ end;return b9 end;function bC.translate(b9,k,K,bR)for d=1,#b9 do local bL=b9[d]bL.x1=bL.x1+(k or 0)bL.x2=bL.x2+(k or 0)bL.x3=bL.x3+(k or 0)bL.y1=bL.y1+(K or 0)bL.y2=bL.y2+(K or 0)bL.y3=bL.y3+(K or 0)bL.z1=bL.z1+(bR or 0)bL.z2=bL.z2+(bR or 0)bL.z3=bL.z3+(bR or 0)end;return b9 end;function bC.alignBottom(b9)local W=math.huge;for d=1,#b9 do local bL=b9[d]W=m(W,bL.y1)W=m(W,bL.y2)W=m(W,bL.y3)end;for d=1,#b9 do local bL=b9[d]bL.y1=bL.y1-W;bL.y2=bL.y2-W;bL.y3=bL.y3-W end;return b9 end;local function bS(bT)local bU=fs.open(bT,"r")if not bU then error("Could not find model for an object at path: "..bT)end;local bV=bU.readAll()bU.close()local b9=textutils.unserialise(bV)for bW,bX in pairs(bC)do b9[bW]=bX end;return b9 end;local bY=math.pi;local a_=math.sin;local b0=math.cos;local bZ=math.tan;local b_=math.sqrt;local function c0(g,h,i,j)local y,c1=term.getSize()if g and i then y=i-g+1 end;if h and j then c1=j-h+1 end;local g=g or 1;local h=h or 1;local i=i or y-g+1;local j=j or c1-h+1;local c2={camera={0.000001,0.000001,0.000001,nil,0,0},buffer=q(g,h,i,j),x1=g,y1=h,x2=i,y2=j,width=y,height=c1,blittleOn=false,pixelratio=1.5}c2.FoV=90;c2.camera[7]=aZ(c2.FoV)c2.t=bZ(aZ(c2.FoV/2))*2*0.0001;local c3,c4,c5,c6;function c2:setBackgroundColor(I)local c7=self.buffer;c7.backgroundColor=I;c7:fastClear()end;local function c8()c3=o(c2.width*0.5)+1;c4=o(c2.height*0.5)c5=0.0001*c2.width/c2.t;c6=-0.0001*c2.width/(c2.t*c2.height*c2.pixelratio)*c2.height end;function c2:setSize(g,h,i,j)self.x1=g;self.y1=h;self.x2=i;self.y2=j;if not self.blittleOn then self.buffer:setBufferSize(g,h,i,j)self.width=i-g+1;self.height=j-h+1;self.pixelratio=1.5 else self.width=(i-g+1)*2;self.height=(j-h+1)*3;self.pixelratio=1;self.buffer:setBufferSize(g,h,g+self.width-1,h+self.height-1)end;c8()end;function c2:highResMode(ae)self.blittleOn=ae;self.buffer:highResMode(ae)if ae then self.width=(self.x2-self.x1+1)*2;self.height=(self.y2-self.y1+1)*3;self.buffer:setBufferSize(self.x1,self.y1,self.x1+self.width-1,self.y1+self.height-1)self.pixelratio=1 else self.buffer:setBufferSize(self.x1,self.y1,self.x2,self.y2)self.width=self.x2-self.x1+1;self.height=self.y2-self.y1+1;self.pixelratio=1.5 end;c8()end;function c2:loadModelRaw(b9)local c9={}local ca=0;for d=1,#b9 do local aV=b9[d]c9[#c9+1]={}c9[#c9][1]=aV.x1;c9[#c9][2]=aV.y1;c9[#c9][3]=aV.z1;c9[#c9][4]=aV.x2;c9[#c9][5]=aV.y2;c9[#c9][6]=aV.z2;c9[#c9][7]=aV.x3;c9[#c9][8]=aV.y3;c9[#c9][9]=aV.z3;c9[#c9][10]=aV.forceRender;c9[#c9][11]=aV.c;c9[#c9][12]=aV.char;c9[#c9][13]=aV.charc;c9[#c9][14]=aV.outlineColor;c9[#c9][15]=d;local cb=b_(aV.x1*aV.x1+aV.y1*aV.y1+aV.z1*aV.z1)local cc=b_(aV.x2*aV.x2+aV.y2*aV.y2+aV.z2*aV.z2)local cd=b_(aV.x3*aV.x3+aV.y3*aV.y3+aV.z3*aV.z3)if cb>ca then ca=cb end;if cc>ca then ca=cc end;if cd>ca then ca=cd end end;return c9,ca end;function c2:map3dTo2d(C,A,b2)local aO=self.camera;local ce=a_(aO[4]or 0)local cf=b0(aO[4]or 0)local cg=a_(-aO[5])local ch=b0(-aO[5])local ci=a_(aO[6])local cj=b0(aO[6])local bz=C-aO[1]local bA=A-aO[2]local bB=b2-aO[3]local ck=ch*bz-cg*bB;bB=cg*bz+ch*bB;bz=ck;local cl=cj*bA-ci*bz;bz=ci*bA+cj*bz;bA=cl;if ce~=0 then local cm=ce*bB-cf*bA;bA=cf*bB+ce*bA;bB=cm end;local cn=bB/bz*c5+c3;local co=bA/bz*c6+c4;return cn,co,bz>=0.0001 end;function c2:drawObject(bv,aO,cp)local bw=bv[1]local bx=bv[2]local by=bv[3]local ce=cp[1]local cf=cp[2]local cg=cp[3]local ch=cp[4]local ci=cp[5]local cj=cp[6]local cq=bw and bw-aO[1]or 0;local cr=bx and bx-aO[2]or 0;local cs=by and by-aO[3]or 0;local b9=bv[7]if#b9<=0 then return end;local ct=bv[8]local bz=cq;local bA=cr;local bB=cs;local ck=ch*bz-cg*bB;local bB=cg*bz+ch*bB;local bz=ck;local bz=ci*bA+cj*bz;if bz<-ct then return end;local cu=0.5*aO[7]local cv=a_(cu)local cw=b0(cu)if(bz+ct)*cv+(bB+ct)*cw<0 then return end;if(bz+ct)*cv-(bB-ct)*cw<0 then return end;local ba=bv[4]local bb=bv[5]local bc=bv[6]if ba and ba~=0 or bb and bb~=0 or bc and bc~=0 then b9=b8(b9,ba,bb,bc)end;aJ(b9,bw,bx,by,aO)local cx=cq*cq+cr*cr+cs*cs<ct*ct*4;local c3=c3;local c4=c4;local c5=c5;local c6=c6;local ce=ce;local cf=cf;local cg=cg;local ch=ch;local ci=ci;local cj=cj;local cq=cq;local cr=cr;local cs=cs;local function cy(bz,bA,bB)local ck=ch*bz-cg*bB;bB=cg*bz+ch*bB;bz=ck;local cl=cj*bA-ci*bz;bz=ci*bA+cj*bz;bA=cl;local cn=bB/bz*c5+c3;local co=bA/bz*c6+c4;return cn,co,bz end;if ce~=0 then function cy(bz,bA,bB)local ck=ch*bz-cg*bB;bB=cg*bz+ch*bB;bz=ck;local cl=cj*bA-ci*bz;bz=ci*bA+cj*bz;bA=cl;local cm=ce*bB-cf*bA;bA=cf*bB+ce*bA;bB=cm;local cn=bB/bz*c5+c3;local co=bA/bz*c6+c4;return cn,co,bz end end;local cz=b9;local c7=self.buffer;for d=1,#cz do local aV=cz[d]local g,h,cA=cy(aV[1]+cq,aV[2]+cr,aV[3]+cs)if cA>0.00010000001 then local i,j,ck=cy(aV[4]+cq,aV[5]+cr,aV[6]+cs)if ck>0.00010000001 then local T,U,cB=cy(aV[7]+cq,aV[8]+cr,aV[9]+cs)if cB>0.00010000001 then if aV[10]or(i-g)*(U-j)-(j-h)*(T-i)<0 then c7:drawTriangle(g,h,i,j,T,U,aV[11],aV[12],aV[13],aV[14])end elseif cx then local function cC(C,A,b2)local bz=C+cq;local bA=A+cr;local bB=b2+cs;local ck=ch*bz-cg*bB;bB=cg*bz+ch*bB;bz=ck;local cl=cj*bA-ci*bz;bz=ci*bA+cj*bz;bA=cl;if ce~=0 then local cm=ce*bB-cf*bA;bA=cf*bB+ce*bA;bB=cm end;local cn=bB/bz*c5+c3;local co=bA/bz*c6+c4;return cn,co,bz,bA,bB end;local g,h,cA,cD,cE=cC(aV[1],aV[2],aV[3])local i,j,ck,cl,cm=cC(aV[4],aV[5],aV[6])local T,U,cB,cF,cG=cC(aV[7],aV[8],aV[9])local cH=math.abs;local cI=cH(cB-0.0001)local cJ=cH(cA-0.0001)local cK=cJ+cI;local cL=(cG*cJ+cE*cI)/cK;local cM=(cF*cJ+cD*cI)/cK;local c3,c5,c4,c6=c3,c5,c4,c6;local cN=cL*10000*c5+c3;local cO=cM*10000*c6+c4;if aV[10]or(i-g)*(cO-j)-(j-h)*(cN-i)<0 then c7:drawTriangle(g,h,i,j,cN,cO,aV[11],aV[12],aV[13],aV[14])local cP=cH(ck-0.0001)local cK=cP+cI;local cL=(cm*cI+cG*cP)/cK;local cM=(cl*cI+cF*cP)/cK;local cQ=cL*10000*c5+c3;local cR=cM*10000*c6+c4;c7:drawTriangle(cQ,cR,i,j,cN,cO,aV[11],aV[12],aV[13],aV[14])end end elseif cx then local function cC(C,A,b2)local bz=C+cq;local bA=A+cr;local bB=b2+cs;local ck=ch*bz-cg*bB;bB=cg*bz+ch*bB;bz=ck;local cl=cj*bA-ci*bz;bz=ci*bA+cj*bz;bA=cl;if ce~=0 then local cm=ce*bB-cf*bA;bA=cf*bB+ce*bA;bB=cm end;local cn=bB/bz*c5+c3;local co=bA/bz*c6+c4;return cn,co,bz,bA,bB end;local g,h,cA,cD,cE=cC(aV[1],aV[2],aV[3])local i,j,ck,cl,cm=cC(aV[4],aV[5],aV[6])local T,U,cB,cF,cG=cC(aV[7],aV[8],aV[9])local cH=math.abs;if cB>0.00010000001 then local cP=cH(ck-0.0001)local cJ=cH(cA-0.0001)local cK=cJ+cP;local cL=(cm*cJ+cE*cP)/cK;local cM=(cl*cJ+cD*cP)/cK;local c3,c5,c4,c6=c3,c5,c4,c6;local cN=cL*10000*c5+c3;local cO=cM*10000*c6+c4;if aV[10]or(cN-g)*(U-cO)-(cO-h)*(T-cN)<0 then c7:drawTriangle(g,h,cN,cO,T,U,aV[11],aV[12],aV[13],aV[14])local cI=cH(cB-0.0001)local cK=cP+cI;local cL=(cm*cI+cG*cP)/cK;local cM=(cl*cI+cF*cP)/cK;local cQ=cL*10000*c5+c3;local cR=cM*10000*c6+c4;c7:drawTriangle(cQ,cR,cN,cO,T,U,aV[11],aV[12],aV[13],aV[14])end else local cJ=cH(cA-0.0001)local cP=cH(ck-0.0001)local cI=cH(cB-0.0001)local cS=cJ+cP;local cT=cJ+cI;local cL=(cE*cP+cm*cJ)/cS;local cM=(cD*cP+cl*cJ)/cS;local c3,c5,c4,c6=c3,c5,c4,c6;local cN=cL*10000*c5+c3;local cO=cM*10000*c6+c4;local cU=(cE*cI+cG*cJ)/cT;local cV=(cD*cI+cF*cJ)/cT;local cQ=cU*10000*c5+c3;local cR=cV*10000*c6+c4;if aV[10]or(cN-g)*(cR-cO)-(cO-h)*(cQ-cN)<0 then c7:drawTriangle(g,h,cN,cO,cQ,cR,aV[11],aV[12],aV[13],aV[14])end end end elseif cx then local function cC(C,A,b2)local bz=C+cq;local bA=A+cr;local bB=b2+cs;local ck=ch*bz-cg*bB;bB=cg*bz+ch*bB;bz=ck;local cl=cj*bA-ci*bz;bz=ci*bA+cj*bz;bA=cl;if ce~=0 then local cm=ce*bB-cf*bA;bA=cf*bB+ce*bA;bB=cm end;local cn=bB/bz*c5+c3;local co=bA/bz*c6+c4;return cn,co,bz,bA,bB end;local g,h,cA,cD,cE=cC(aV[1],aV[2],aV[3])local i,j,ck,cl,cm=cC(aV[4],aV[5],aV[6])local T,U,cB,cF,cG=cC(aV[7],aV[8],aV[9])local cH=math.abs;if ck>0.00010000001 then if cB>0.00010000001 then local cJ=cH(cA-0.0001)local cP=cH(ck-0.0001)local cK=cJ+cP;local cL=(cE*cP+cm*cJ)/cK;local cM=(cD*cP+cl*cJ)/cK;local c3,c5,c4,c6=c3,c5,c4,c6;local cN=cL*10000*c5+c3;local cO=cM*10000*c6+c4;if aV[10]or(i-cN)*(U-j)-(j-cO)*(T-i)<0 then c7:drawTriangle(cN,cO,i,j,T,U,aV[11],aV[12],aV[13],aV[14])local cI=cH(cB-0.0001)local cK=cJ+cI;local cL=(cE*cI+cG*cJ)/cK;local cM=(cD*cI+cF*cJ)/cK;local cQ=cL*10000*c5+c3;local cR=cM*10000*c6+c4;c7:drawTriangle(cN,cO,cQ,cR,T,U,aV[11],aV[12],aV[13],aV[14])end else local cJ=cH(cA-0.0001)local cP=cH(ck-0.0001)local cI=cH(cB-0.0001)local cS=cP+cJ;local cT=cP+cI;local cL=(cE*cP+cm*cJ)/cS;local cM=(cD*cP+cl*cJ)/cS;local c3,c5,c4,c6=c3,c5,c4,c6;local cN=cL*10000*c5+c3;local cO=cM*10000*c6+c4;local cU=(cm*cI+cG*cP)/cT;local cV=(cl*cI+cF*cP)/cT;local cQ=cU*10000*c5+c3;local cR=cV*10000*c6+c4;if aV[10]or(i-cN)*(cR-j)-(j-cO)*(cQ-i)<0 then c7:drawTriangle(cN,cO,i,j,cQ,cR,aV[11],aV[12],aV[13],aV[14])end end else if cB>0.00010000001 then local cJ=cH(cA-0.0001)local cP=cH(ck-0.0001)local cI=cH(cB-0.0001)local cS=cI+cJ;local cT=cI+cP;local cL=(cE*cI+cG*cJ)/cS;local cM=(cD*cI+cF*cJ)/cS;local c3,c5,c4,c6=c3,c5,c4,c6;local cN=cL*10000*c5+c3;local cO=cM*10000*c6+c4;local cU=(cm*cI+cG*cP)/cT;local cV=(cl*cI+cF*cP)/cT;local cQ=cU*10000*c5+c3;local cR=cV*10000*c6+c4;if aV[10]or(cQ-cN)*(U-cR)-(cR-cO)*(T-cQ)<0 then c7:drawTriangle(cN,cO,cQ,cR,T,U,aV[11],aV[12],aV[13],aV[14])end end end end end end;function c2:drawObjects(br)local aO=self.camera;local cp={a_(aO[4]or 0),b0(aO[4]or 0),a_(-aO[5]),b0(-aO[5]),a_(aO[6]),b0(aO[6])}bq(br,aO)local br=br;for d=1,#br do self:drawObject(br[d],aO,cp)end end;function c2:drawBuffer()local c7=self.buffer;c7:drawBuffer()c7:fastClear()end;function c2:setCamera(cW,cX,cY,ba,bb,bc)local aZ=math.rad;if type(cW)=="table"then local aO=cW;self.camera={aO.x or self.camera[1]or 0,aO.y or self.camera[2]or 0,aO.z or self.camera[3]or 0,aO.rotX and aZ(aO.rotX+90)or self.camera[4]or 0,aO.rotY and aZ(aO.rotY)or self.camera[5]or 0,aO.rotZ and aZ(aO.rotZ)or self.camera[6]or 0,self.camera[7]}else self.camera={cW or self.camera[1]or 0,cX or self.camera[2]or 0,cY or self.camera[3]or 0,ba and aZ(ba+90)or self.camera[4]or 0,bb and aZ(bb)or self.camera[5]or 0,bc and aZ(bc)or self.camera[6]or 0,self.camera[7]}end;if self.camera[4]==math.pi*0.5 then self.camera[4]=nil end end;function c2:setFoV(cu)self.FoV=cu or 90;self.t=bZ(aZ(self.FoV/2))*2*0.0001;c8()self.camera[7]=aZ(self.FoV)end;function c2:setWireFrame(ae)self.buffer:useTriangleEdges(ae)end;function c2:getObjectIndexTrace(br,C,A)local function cZ(c_,d0,d1)return(c_.x-d1.x)*(d0.y-d1.y)-(d0.x-d1.x)*(c_.y-d1.y)end;local function d2(d3,d4,g,h,i,j,T,U,d5,d6,d7,d8)local a4=cZ({x=d3,y=d4},{x=g,y=h},{x=i,y=j})<0;local a6=cZ({x=d3,y=d4},{x=i,y=j},{x=T,y=U})<0;local a8=cZ({x=d3,y=d4},{x=T,y=U},{x=g,y=h})<0;return a4==a6 and a6==a8 end;local A=A-1;local d9={}if self.blittleOn then C=C*2;A=A*3+1 end;local aO=self.camera;local cp={a_(aO[4]or 0),b0(aO[4]or 0),a_(-aO[5]),b0(-aO[5]),a_(aO[6]),b0(aO[6])}local ce=cp[1]local cf=cp[2]local cg=cp[3]local ch=cp[4]local ci=cp[5]local cj=cp[6]for d=1,#br do local bv=br[d]local b9=bv[7]local ba=bv[4]local bb=bv[5]local bc=bv[6]if ba and ba~=0 or bb and bb~=0 or bc and bc~=0 then b9=b8(b9,ba,bb,bc)end;local bw=bv[1]local bx=bv[2]local by=bv[3]local c3=c3;local c4=c4;local c5=c5;local c6=c6;local ce=ce;local cf=cf;local cg=cg;local ch=ch;local ci=ci;local cj=cj;local cq=bw-aO[1]local cr=bx-aO[2]local cs=by-aO[3]local function cy(C,A,b2)local bz=C+cq;local bA=A+cr;local bB=b2+cs;local ck=ch*bz-cg*bB;bB=cg*bz+ch*bB;bz=ck;local cl=cj*bA-ci*bz;bz=ci*bA+cj*bz;bA=cl;if ce~=0 then local cm=ce*bB-cf*bA;bA=cf*bB+ce*bA;bB=cm end;local cn=bB/bz*c5+c3;local co=bA/bz*c6+c4;return cn,co,bz>0 end;for av=1,#b9 do local aV=b9[av]local g,h,da=cy(aV[1],aV[2],aV[3])if da then local i,j,db=cy(aV[4],aV[5],aV[6])if db then local T,U,dc=cy(aV[7],aV[8],aV[9])if dc then if aV[10]or(i-g)*(U-j)-(j-h)*(T-i)<0 then if not self.blittleOn then if d2(C,A,g,h,i,j,T,U,self.x1,self.y1,self.x2,self.y2)then d9[#d9+1]={objectIndex=d,polygonIndex=aV[15]}end else if d2(C,A,g,h,i,j,T,U,(self.x2-1)*2+1,(self.y1-1)*3+1,self.x2*2,(self.y2+1)*3)then d9[#d9+1]={objectIndex=d,polygonIndex=aV[15]}end end end end end end end end;if#d9<=0 then return elseif#d9==1 then return d9[1].objectIndex,d9[1].polygonIndex end;local dd={}local de=-1;local df=math.huge;for d=1,#d9 do local bv=br[d9[d].objectIndex]local bz=aO[1]-bv[1]local bA=aO[2]-bv[2]local bB=aO[3]-bv[3]local dg=b_(bz*bz+bA*bA+bB*bB)if dg<df then df=dg;de=d9[d].objectIndex end end;for d=1,#d9 do local bv=br[d9[d].objectIndex]local bz=aO[1]-bv[1]local bA=aO[2]-bv[2]local bB=aO[3]-bv[3]local dg=b_(bz*bz+bA*bA+bB*bB)if dg==df then dd[#dd+1]=d9[d].polygonIndex end end;local bv=br[de]local b9=bv[7]local dh=-1;local di=math.huge;local aS=bv[1]-aO[1]local aT=bv[2]-aO[2]local aU=bv[3]-aO[3]for d=1,#dd do local dj=dd[d]local aV=b9[dj]local aW=aS+(aV[1]+aV[4]+aV[7])/3;local aX=aT+(aV[2]+aV[5]+aV[8])/3;local aY=aU+(aV[3]+aV[6]+aV[9])/3;local dg=b_(aW*aW+aX*aX+aY*aY)if dg<di then di=dg;dh=dd[d]end end;return de,dh end;function c2:newObject(b9,C,A,b2,ba,bb,bc)local dk=nil;local ct=nil;if type(b9)=="table"then dk,ct=self:loadModelRaw(b9)else local dl=bS(b9)dk,ct=self:loadModelRaw(dl)end;local bv={C,A,b2,ba,bb,bc,dk,ct}bv.frame=self;function bv:setPos(dm,dn,dp)self[1]=dm or self[1]self[2]=dn or self[2]self[3]=dp or self[3]end;function bv:setRot(dq,dr,ds)self[4]=dq or self[4]self[5]=dr or self[5]self[6]=ds or self[6]end;function bv:setModel(dt)if type(dt)=="table"then dk,ct=self.frame:loadModelRaw(dt)self[7]=dk;self[8]=ct else local dl=bS(dt)dk,ct=self.frame:loadModelRaw(dl)self[7]=dk;self[8]=ct end end;return bv end;c8()c2:highResMode(true)return c2 end;local du={}local function dv(g,h,bl,i,j,b5,T,U,bm,I)local bL={x1=g,y1=h,z1=bl,x2=i,y2=j,z2=b5,x3=T,y3=U,z3=bm,c=I}return bL end;function du:cube(dw)dw.color=dw.color or colors.red;local dx={dv(-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,dw.bottom or dw.color),dv(-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,dw.bottom2 or dw.bottom or dw.color),dv(-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,dw.top or dw.color),dv(-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,dw.top or dw.color),dv(-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,dw.side or dw.color),dv(-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,dw.side2 or dw.side or dw.color),dv(.5,-.5,-.5,.5,.5,.5,.5,-.5,.5,dw.side or dw.color),dv(.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,dw.side2 or dw.side or dw.color),dv(-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,dw.side or dw.color),dv(-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,dw.side2 or dw.side or dw.color),dv(-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,dw.side or dw.color),dv(.5,-.5,.5,.5,.5,.5,-.5,.5,.5,dw.side2 or dw.side or dw.color)}return dx end;function du:sphere(dw)dw.res=dw.res or 32;dw.color=dw.color or colors.red;local b9={}local dy={}for d=0,dw.res do local A=0.5*b0(d/dw.res*bY)local dz={}for av=0,dw.res do local dA=0.5*b_(1-A*2*A*2)local C=b0(av/dw.res*bY*2)*dA;local b2=a_(av/dw.res*bY*2)*dA;local i=b0((av+1)/dw.res*bY*2)*dA;local b5=a_((av+1)/dw.res*bY*2)*dA;if dy[av]then b9[#b9+1]={x1=dy[(av+1)%dw.res].x,y1=dy[(av+1)%dw.res].y,z1=dy[(av+1)%dw.res].z,x2=C,y2=A,z2=b2,x3=dy[av].x,y3=dy[av].y,z3=dy[av].z,c=dw.color}b9[#b9+1]={x1=i,y1=A,z1=b5,x2=C,y2=A,z2=b2,x3=dy[(av+1)%dw.res].x,y3=dy[(av+1)%dw.res].y,z3=dy[(av+1)%dw.res].z,c=dw.color2 or dw.color}end;dz[av]={x=C,y=A,z=b2}end;dy=dz end;if dw.colors or dw.top or dw.bottom then for d=1,#b9 do local bL=b9[d]local aX=(bL.y1+bL.y2+bL.y3)/3;if dw.colors then local dB=o((-aX+0.5)*#dw.colors+1)bL.c=dw.colors[dB]or bL.c else if aX>=0 then bL.c=dw.top or bL.c else bL.c=dw.bottom or bL.c end end end end;return b9 end;function du:icosphere(dw)dw.res=dw.res or 1;local dC=(1+b_(5))/2;local aH={{dC,1,0},{dC,-1,0},{-dC,-1,0},{-dC,1,0},{1,0,dC},{-1,0,dC},{-1,0,-dC},{1,0,-dC},{0,dC,1},{0,dC,-1},{0,-dC,-1},{0,-dC,1}}local function dD(dE,dF,dG)return dv(aH[dE][1],aH[dE][2],aH[dE][3],aH[dF][1],aH[dF][2],aH[dF][3],aH[dG][1],aH[dG][2],aH[dG][3],dw.colors and 1 or dw.color)end;local b9={dD(11,2,12),dD(11,8,2),dD(11,7,8),dD(11,3,7),dD(11,12,3),dD(4,7,3),dD(4,10,7),dD(4,9,10),dD(4,6,9),dD(4,3,6),dD(5,6,12),dD(5,9,6),dD(5,1,9),dD(5,2,1),dD(5,12,2),dD(3,12,6),dD(1,8,10),dD(1,10,9),dD(1,2,8),dD(10,8,7)}local function dH()local bD={}for d=1,#b9 do local bL=b9[d]local dI={x=(bL.x1+bL.x2)/2,y=(bL.y1+bL.y2)/2,z=(bL.z1+bL.z2)/2}local dJ={x=(bL.x1+bL.x3)/2,y=(bL.y1+bL.y3)/2,z=(bL.z1+bL.z3)/2}local dK={x=(bL.x2+bL.x3)/2,y=(bL.y2+bL.y3)/2,z=(bL.z2+bL.z3)/2}local dL=bL.c;if dw.colorsFractal then dL=dL%#dw.colors+1 end;bD[#bD+1]=dv(dI.x,dI.y,dI.z,dK.x,dK.y,dK.z,dJ.x,dJ.y,dJ.z,bL.c)bD[#bD+1]=dv(bL.x1,bL.y1,bL.z1,dI.x,dI.y,dI.z,dJ.x,dJ.y,dJ.z,dL)bD[#bD+1]=dv(dI.x,dI.y,dI.z,bL.x2,bL.y2,bL.z2,dK.x,dK.y,dK.z,dL)bD[#bD+1]=dv(dJ.x,dJ.y,dJ.z,dK.x,dK.y,dK.z,bL.x3,bL.y3,bL.z3,dL)end;b9=bD end;for d=1,dw.res-1 do dH()end;local function dM(C,A,b2)local dN=math.sqrt(C*C+A*A+b2*b2)local dO=0.5/dN;return C*dO,A*dO,b2*dO end;for d=1,#b9 do local bL=b9[d]bL.x1,bL.y1,bL.z1=dM(bL.x1,bL.y1,bL.z1)bL.x2,bL.y2,bL.z2=dM(bL.x2,bL.y2,bL.z2)bL.x3,bL.y3,bL.z3=dM(bL.x3,bL.y3,bL.z3)if not dw.colorsFractal then local aX=(bL.y1+bL.y2+bL.y3)/3;if dw.colors then local dB=math.floor((-aX+0.5)*#dw.colors+1)bL.c=dw.colors[dB]or bL.c else if aX>=0 then bL.c=dw.top or bL.c else bL.c=dw.bottom or bL.c end end else bL.c=dw.colors[bL.c]end end;return b9 end;function du:plane(dw)dw.color=dw.color or colors.lime;dw.size=dw.size or 1;dw.y=dw.y or 0;local dP={dv(-1*dw.size,dw.y,1*dw.size,1*dw.size,dw.y,-1*dw.size,-1*dw.size,dw.y,-1*dw.size,dw.color),dv(-1*dw.size,dw.y,1*dw.size,1*dw.size,dw.y,1*dw.size,1*dw.size,dw.y,-1*dw.size,dw.color)}return dP end;function du:mountains(dw)dw.res=dw.res or 20;dw.randomOffset=dw.randomOffset or 0;dw.height=dw.height or 1;dw.randomHeight=dw.randomHeight or 0;dw.y=dw.y or 0;dw.scale=dw.scale or 100;dw.color=dw.color or colors.green;dw.snowColor=dw.snowColor or colors.white;local dQ=3/dw.res*dw.height/(dw.randomHeight+1)local dR=3/dw.res*dw.height*(dw.randomHeight+1)local b9={}for d=0,dw.res do local dS=math.random(-dw.randomOffset*100,dw.randomOffset*100)/100;local dT=d+dS;local g=b0((dT-1)/dw.res*bY*2)*dw.scale;local bl=a_((dT-1)/dw.res*bY*2)*dw.scale;local i=b0((dT-0.5)/dw.res*bY*2)*dw.scale;local b5=a_((dT-0.5)/dw.res*bY*2)*dw.scale;local T=b0(dT/dw.res*bY*2)*dw.scale;local bm=a_(dT/dw.res*bY*2)*dw.scale;local dU=math.random(dQ*100,dR*100)/100*dw.scale;local aV={x1=g,y1=dw.y,z1=bl,x2=T,y2=dw.y,z2=bm,x3=i,y3=dw.y+dU,z3=b5,c=dw.color,forceRender=true}b9[#b9+1]=aV;if dw.snow then local dV=0.93;local dW=dw.snowHeight or 0.5;local dX=1-dW*dR/(dU/dw.scale)dX=n(0,m(1,dX))if dX>0.2 then local dY={x1=(g*dX+i*(1-dX))*dV,y1=dw.y+dU*(1-dX),z1=(bl*dX+b5*(1-dX))*dV,x2=(T*dX+i*(1-dX))*dV,y2=dw.y+dU*(1-dX),z2=(bm*dX+b5*(1-dX))*dV,x3=i*dV,y3=dw.y+dU,z3=b5*dV,c=dw.snowColor,forceRender=true}b9[#b9+1]=dY end end end;return b9 end;return{newFrame=c0,loadModel=bS,newBuffer=q,linear=f,models=du,transforms=bC}